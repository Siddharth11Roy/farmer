<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Detection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .upload-section {
            border: 2px dashed #3498db;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        #preview {
            max-width: 300px;
            max-height: 300px;
            margin-top: 20px;
            display: none;
        }
        .result-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .loading {
            display: none;
            margin-top: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Plant Disease Detection</h1>
    <p>Upload a photo of a plant leaf to detect any diseases.</p>

    <div class="upload-section">
        <input type="file" id="imageInput" accept="image/*">
        <div>
            <img id="preview" alt="Image preview">
        </div>
        <div class="loading" id="loading">
            <p>Analyzing image... please wait</p>
        </div>
    </div>

    <button id="analyzeBtn" disabled>Analyze Image</button>

    <div class="result-section" id="resultSection" style="display: none;">
        <h2>Detection Results</h2>
        <div id="results"></div>
    </div>

    <script>
        // Elements
        const imageInput = document.getElementById('imageInput');
        const preview = document.getElementById('preview');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loadingSection = document.getElementById('loading');
        const resultSection = document.getElementById('resultSection');
        const resultsDiv = document.getElementById('results');
        
        // Show image preview when selected
        imageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    analyzeBtn.disabled = false;
                }
                reader.readAsDataURL(file);
                // Hide previous results when new image is selected
                resultSection.style.display = 'none';
            }
        });
        
        // Handle the analyze button click
        analyzeBtn.addEventListener('click', async function() {
            const file = imageInput.files[0];
            if (!file) return;
            
            try {
                // Show loading indicator
                loadingSection.style.display = 'block';
                resultSection.style.display = 'none';
                analyzeBtn.disabled = true;
                
                // Call the API
                const result = await detectPlantDisease(file);
                
                // Display results
                displayResults(result);
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                resultSection.style.display = 'block';
            } finally {
                loadingSection.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        });
        
        // API call function
        async function detectPlantDisease(imageFile) {
            // Replace with your actual API endpoint
            const apiUrl = "https://sid26roy-farmer-prediction.hf.space/gradio_api/predict";
            // Create a FormData object to send the image file
            // This is important for file uploads
            // Make sure to adjust the field name in formData.append() to match your API's expectations
            // For example, if your API expects a field named "file", use that name
            // If your API requires authentication, you may need to include headers as well
            // const apiUrl = "https://your-api-endpoint.com/predict";
            
            const formData = new FormData();
            formData.append("img", imageFile); // Make sure the field name matches what your Gradio app expects
            
            const response = await fetch(apiUrl, {
                method: "POST",
                body: formData,
                // Add authorization if needed
                // headers: {
                //     "Authorization": "Bearer YOUR_HF_TOKEN"
                // }
            });
            
            if (!response.ok) {
                throw new Error(`API error: ${response.status} ${response.statusText}`);
            }
            
            return await response.json();
        }
        
        // Display the results on the page
        function displayResults(result) {
            // Clear previous results
            resultsDiv.innerHTML = '';
            
            // Check the structure of your API response and adjust accordingly
            if (result && result.data) {
                const data = result.data;
                
                // Create HTML to display the results
                // This assumes your API returns a prediction label and confidence
                let html = '<div>';
                
                // If your API returns an array of predictions with confidence scores
                if (Array.isArray(data)) {
                    html += '<ul>';
                    data.forEach(item => {
                        html += `<li><strong>${item.label}:</strong> ${(item.confidence * 100).toFixed(2)}%</li>`;
                    });
                    html += '</ul>';
                } else if (typeof data === 'string') {
                    // If your API simply returns a string result
                    html += `<p><strong>Prediction:</strong> ${data}</p>`;
                } else {
                    // If your API returns an object with prediction details
                    html += `<p><strong>Prediction:</strong> ${data.prediction || data.label || 'Unknown'}</p>`;
                    if (data.confidence) {
                        html += `<p><strong>Confidence:</strong> ${(data.confidence * 100).toFixed(2)}%</p>`;
                    }
                }
                
                html += '</div>';
                resultsDiv.innerHTML = html;
            } else {
                resultsDiv.innerHTML = '<p>No results returned from API</p>';
            }
            
            // Show the results section
            resultSection.style.display = 'block';
            
            // For debugging - log the full response to console
            console.log("Full API response:", result);
        }
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Prediction</title>
</head>
<body>
    <h2>Upload an Image for Disease Prediction</h2>
    <input type="file" id="imageUpload" accept="image/*">
    <button onclick="predictDisease()">Predict</button>
    <p id="predictionResult"></p>

    <script>
        async function predictDisease() {
            const fileInput = document.getElementById("imageUpload");
            if (!fileInput.files.length) {
                alert("Please upload an image first.");
                return;
            }

            const file = fileInput.files[0];  // Get the uploaded file
            const formData = new FormData();
            formData.append("data", file);  // Gradio API expects "data" as key

            try {
                const response = await fetch("https://sid26roy-farmer-prediction.hf.space/run/predict", {
                    method: "POST",
                    headers: {
                        "Authorization": "Bearer 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"  // Replace with your token
                    },
                    body: formData
                });

                const result = await response.json();
                if (result && result.data) {
                    document.getElementById("predictionResult").innerText = "Predicted Disease: " + result.data[0];
                } else {
                    document.getElementById("predictionResult").innerText = "Error: Could not get prediction.";
                }
            } catch (error) {
                console.error("Error:", error);
                document.getElementById("predictionResult").innerText = "Error: Failed to connect to the server.";
            }
        }
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Prediction</title>
</head>
<body>
    <h2>Upload an Image for Plant Disease Prediction</h2>
    <input type="file" id="imageUpload" accept="image/*">
    <button onclick="predict()">Predict</button>
    <p id="result"></p>

    <script>
        async function predict() {
            const fileInput = document.getElementById("imageUpload");
            if (fileInput.files.length === 0) {
                alert("Please select an image.");
                return;
            }

            const formData = new FormData();
            formData.append("img", fileInput.files[0]);  // Matches the API param name

            try {
                const response = await fetch("https://sid26roy-farmer-prediction.hf.space/api/predict", {
                    method: "POST",
                    headers: {
                        "Authorization": "Bearer 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"  // Replace with your actual Hugging Face API token
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Error: ${response.statusText}`);
                }

                const result = await response.json();
                document.getElementById("result").innerText = "Prediction: " + result.data[0];
            } catch (error) {
                console.error("Prediction error:", error);
                document.getElementById("result").innerText = "Error: Unable to get prediction.";
            }
        }
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Classification</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

    <h2>Upload Plant Image</h2>
    <input type="file" id="imageUpload" accept="image/*">
    <button onclick="handleSend()">Predict</button>

    <p id="loadingMessage" style="display: none;">Processing...</p>
    <h3>Prediction: <span id="result"></span></h3>

    <script>
        async function handleSend() {
            let fileInput = document.getElementById("imageUpload");
            let resultText = document.getElementById("result");
            let loadingMessage = document.getElementById("loadingMessage");

            if (fileInput.files.length === 0) {
                alert("Please select an image first.");
                return;
            }

            let formData = new FormData();
            formData.append("image", fileInput.files[0]);

            loadingMessage.style.display = "block";
            resultText.innerText = "";

            try {
                const response = await axios.post(
                    "https://sid26roy-farmer-prediction.hf.space/predict", // Update with your Hugging Face API URL
                    formData,
                    {
                        headers: {
                            "Content-Type": "multipart/form-data"
                        }
                    }
                );

                resultText.innerText = response.data.data; // Adjust based on actual API response format
            } catch (error) {
                console.error("Error:", error);
                resultText.innerText = "Error in prediction.";
            }

            loadingMessage.style.display = "none";
        }
    </script>

</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Classifier</title>
    <script type="module">
        import { Client, handle_file } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

        document.addEventListener("DOMContentLoaded", async function () {
            const classifyBtn = document.getElementById("classifyBtn");
            const fileInput = document.getElementById("fileInput");
            const resultDiv = document.getElementById("result");

            classifyBtn.addEventListener("click", async () => {
                if (!fileInput.files.length) {
                    alert("Please upload an image first!");
                    return;
                }
                
                const file = fileInput.files[0];
                resultDiv.innerHTML = "Processing...";
                classifyBtn.disabled = true;
                
                try {
                    const client = await Client.connect("Sid26Roy/Farmer_prediction"); // Replace with actual space ID
                    const prediction = await client.predict("/predict", [handle_file(file)]);
                    resultDiv.innerHTML = "Prediction: " + prediction.data;
                } catch (error) {
                    resultDiv.innerHTML = "Error: " + error.message;
                } finally {
                    classifyBtn.disabled = false;
                }
            });
        });
    </script>
</head>
<body>
    <h2>Plant Disease Classifier</h2>
    <input type="file" id="fileInput" accept="image/*">
    <button id="classifyBtn">Classify</button>
    <p id="result"></p>
</body>
</html>

